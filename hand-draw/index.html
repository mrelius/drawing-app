<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Debug Hand-Tracked Drawing</title>
  <style>
    html, body { margin:0; padding:0; overflow:hidden; height:100%; }
    video, canvas {
      position:absolute; top:0; left:0;
      width:100%; height:100%;
      object-fit:cover;
      transform: scaleX(-1);
    }
  </style>
</head>
<body>
  <video id="video" autoplay playsinline muted></video>
  <canvas id="canvas"></canvas>

  <!-- Load MediaPipe -->
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
  <script>
    const video  = document.getElementById('video'),
          canvas = document.getElementById('canvas'),
          ctx    = canvas.getContext('2d');

    let drawing = false,
        lastPos = null;

    function isIndexExtended(lm) { return lm[8].y < lm[6].y; }
    function isFist(lm)        { return [8,12,16,20].every(i=>lm[i].y>lm[i-2].y); }

    function onResults(results) {
      // frame arrived
      console.log('Frame:', performance.now());

      canvas.width  = video.videoWidth;
      canvas.height = video.videoHeight;
      ctx.clearRect(0,0,canvas.width,canvas.height);

      const handsData = results.multiHandLandmarks;
      console.log('Landmarks count:', handsData.length);
      if (handsData.length) {
        const lm = handsData[0];

        if (isIndexExtended(lm)) {
          drawing = true;
        } else if (isFist(lm)) {
          drawing = false;
          lastPos = null;
        }
        console.log('Drawing mode:', drawing);

        const x = (1 - lm[8].x) * canvas.width;
        const y = lm[8].y * canvas.height;

        // red debug dot
        ctx.fillStyle = 'red';
        ctx.beginPath();
        ctx.arc(x,y,8,0,2*Math.PI);
        ctx.fill();

        // black stroke
        if (drawing && lastPos) {
          ctx.strokeStyle = 'black';
          ctx.lineWidth   = 4;
          ctx.lineCap     = 'round';
          ctx.beginPath();
          ctx.moveTo(lastPos.x, lastPos.y);
          ctx.lineTo(x,y);
          ctx.stroke();
        }
        lastPos = { x,y };
      }
    }

    const hands = new Hands({
      locateFile: f => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${f}`
    });
    hands.setOptions({
      maxNumHands:           1,
      modelComplexity:       1,
      minDetectionConfidence:0.8,
      minTrackingConfidence: 0.8
    });
    hands.onResults(onResults);

    // Start camera via MediaPipe Camera helper
    const cam = new Camera(video, {
      onFrame: async () => {
        console.log('Sending frame to model');
        await hands.send({ image: video });
      },
      width: 640,
      height: 480
    });
    cam.start().catch(e => console.error('Camera start error:', e));
  </script>
</body>
</html>
